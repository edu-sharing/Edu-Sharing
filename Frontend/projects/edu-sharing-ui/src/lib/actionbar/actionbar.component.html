<es-dropdown
  #dropdownRef
  [options]="optionsMenu$ | async"
  [showDisabled]="showDisabled"
  [position]="dropdownPosition"
></es-dropdown>
<div
  class="actionbar"
  [class.actionbar-all-flat]="style === 'flat'"
  [class.actionbar-background-dark]="backgroundType === 'dark'"
  [class.actionbar-background-primary]="backgroundType === 'primary'"
  [class.actionbar-round]="appearance === 'round'"
  [class.actionbar-icon-button]="appearance === 'icon-button'"
>
  <div
    *ngIf="optionsToggleBefore.length"
    class="actionToggle before"
    [class.actionToggleDivider]="(optionsAlways$ | async).length"
  >
    <ng-container
      *ngTemplateOutlet="toggle; context: { optionsToggle: optionsToggleBefore }"
    ></ng-container>
  </div>
  <ng-container *ngFor="let option of optionsAlways$ | async; let i = index">
    <button
      *ngIf="shouldHighlight(i, option)"
      mat-flat-button
      color="primary"
      [disabled]="!option.isEnabled"
      [class.display-none]="!option.isEnabled && !showDisabled"
      matTooltip="{{ option | optionTooltip | async }}"
      [matTooltipPosition]="tooltipPosition"
      [attr.aria-label]="option.ariaLabel || option.name | translate"
      (click)="click(option)"
    >
      <i [esIcon]="option.icon"></i>
      <span class="action-always-caption" *ngIf="option.showName && appearance === 'button'">
        {{ option.name | translate }}</span
      >
    </button>
    <button
      *ngIf="!shouldHighlight(i, option)"
      mat-button
      color="primary"
      [disabled]="!option.isEnabled"
      [class.display-none]="!option.isEnabled && !showDisabled"
      matTooltip="{{ option | optionTooltip | async }}"
      [matTooltipPosition]="tooltipPosition"
      [attr.aria-label]="option.ariaLabel || option.name | translate"
      (click)="click(option)"
    >
      <i [esIcon]="option.icon"></i>
      <span class="action-always-caption" *ngIf="option.showName && appearance === 'button'">
        {{ option.name | translate }}</span
      >
    </button>
  </ng-container>
  <button
    mat-button
    color="primary"
    class="more"
    [attr.aria-label]="'OPTIONS.SHOW_ALL_OPTIONS' | translate"
    [matMenuTriggerFor]="dropdownRef.menu"
    *ngIf="canShowDropdown()"
    data-test="more-actions-button"
  >
    <i esIcon="more_vert" [aria]="false"></i>
  </button>
  <div
    *ngIf="optionsToggleAfter.length"
    class="actionToggle after"
    [class.actionToggleDivider]="(optionsAlways$ | async).length"
  >
    <ng-container
      *ngTemplateOutlet="toggle; context: { optionsToggle: optionsToggleAfter }"
    ></ng-container>
  </div>
</div>
<ng-template #toggle let-optionsToggle="optionsToggle">
  <ng-container *ngFor="let option of optionsToggle">
    <button
      *ngIf="option.isToggleVisible"
      mat-icon-button
      matTooltip="{{ option.name | translate }}"
      [attr.aria-label]="option.ariaLabel || option.name | translate"
      (click)="click(option)"
      [class]="
        'toggle-' +
        (option.name | replaceChars : { search: '.', replace: '-' }) +
        (option.isEnabled ? '' : ' disabled')
      "
      attr.data-test="toggle-{{ option.name }}"
    >
      <i [esIcon]="option.icon" [aria]="false"></i>
    </button>
  </ng-container>
</ng-template>
